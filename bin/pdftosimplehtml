#!/usr/bin/env bash

if [[ "${@---help}" =~ '--help' ]]; then
  >&2 cat <<HELP
Usage: pdftosimplehtml article.pdf > article.html

This calls Poppler's pdftohtml with the -stdout option and pipes that
through several sed expressions to clean up the resulting HTML.
HELP
  exit 1
fi

if ! command -v pdftohtml >/dev/null 2>&1; then
  >&2 cat <<MISSING
Could not find 'pdftohtml' command. You need to install Poppler:

    brew install poppler

Continuing anyway... prepare for impact.
MISSING
fi

# sed commands:
# 1) replace no-break spaces with normal spaces
# 2) replace visual line break tags with spaces
# 3) replace horizontal rules with spaces
# 4) remove anchor tags
# 5) shrink styling away from whitespace

pdftohtml -i -stdout "$1" | sed \
  -e 's/&#160;/ /g' \
  -e 's:<br/>: :g' \
  -e 's:<hr/>: :g' \
  -e 's:<a[^>]*>::g' -e 's:</a>::g' \
  -e 's: </i>:</i> :g'
